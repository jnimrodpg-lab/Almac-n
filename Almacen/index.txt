<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Sistema de Ubicaci贸n</title>

<style>
body {
  font-family: Arial, sans-serif;
  padding: 20px;
  background: #f6f6f6;
}

h2 { text-align:center; }

.contenedor-principal {
  display:flex;
  gap:20px;
}

.panel-izquierdo {
  flex:1;
}

.panel-derecho {
  flex:1;
  position:sticky;
  top:10px;
}

input {
  width:100%;
  padding:12px;
  margin-bottom:15px;
  font-size:16px;
}

table {
  width:100%;
  border-collapse:collapse;
  background:white;
}

th, td {
  padding:10px;
  border:1px solid #ccc;
}

th { background:#333; color:white; }

.zona {
  fill:#e8eef7;
  stroke:#333;
  stroke-width:2;
}

.highlight {
  fill:#ffc107 !important;
  stroke:#ff5722 !important;
  stroke-width:4;
}

/* ===== MUEBLE FRONTAL ===== */

.mueble-container {
  position:relative;
  max-width:800px;
}

.modulo {
  position:absolute;
  top:0;
  bottom:0;
  background:rgba(255,193,7,0.4);
  display:none;
}

.modulo.activo {
  display:block;
}

/* ===== VISTA ZENITAL ===== */

.estante-top {
  fill:#d4b48c;
  stroke:#8b6f47;
  stroke-width:2;
}

.estante-top.activo {
  fill:#ffc107;
  stroke:#ff5722;
  stroke-width:3;
}

@media (max-width:900px){
  .contenedor-principal{
    flex-direction:column;
  }
}
</style>
</head>

<body>

<h2> Sistema de Ubicaci贸n</h2>

<div class="contenedor-principal">

<!-- PANEL IZQUIERDO -->
<div class="panel-izquierdo">

<input type="text" id="buscar" placeholder="Buscar producto...">

<table>
<thead>
<tr>
<th>Barras</th>
<th>Nombre</th>
<th>Variante</th>
<th>Ubicaci贸n</th>
<th>Almac茅n</th>
</tr>
</thead>
<tbody id="tabla"></tbody>
</table>

</div>

<!-- PANEL DERECHO -->
<div class="panel-derecho">

<!-- MAPA GENERAL -->
<svg viewBox="0 0 800 500" width="100%">

<path id="Z1" class="zona"
d="M 20 180 H 220 V 350 H 20 Z"/>
<text x="90" y="260">ZONA 1</text>

<path id="Z2" class="zona"
d="M 220 100 H 550 V 420 H 220 Z"/>
<text x="350" y="260">ZONA 2</text>

<path id="Z3" class="zona"
d="M 300 20 H 500 V 100 H 300 Z"/>
<text x="360" y="70">ZONA 3</text>

<path id="A" class="zona"
d="M 550 200 H 780 V 400 H 550 Z"
stroke-dasharray="6"/>
<text x="620" y="300">ZONA 4</text>

</svg>

<!-- DETALLE Z2 -->
<div id="zona2Detalle" style="display:none; margin-top:20px;">

<h3>П Estantes Zona 2</h3>

<div class="mueble-container">

<img src="mueble_z2.png" style="width:100%; display:block;">

<!-- 8 m贸dulos -->
<div id="modulo1" class="modulo" style="left:0%; width:12.5%;"></div>
<div id="modulo2" class="modulo" style="left:12.5%; width:12.5%;"></div>
<div id="modulo3" class="modulo" style="left:25%; width:12.5%;"></div>
<div id="modulo4" class="modulo" style="left:37.5%; width:12.5%;"></div>
<div id="modulo5" class="modulo" style="left:50%; width:12.5%;"></div>
<div id="modulo6" class="modulo" style="left:62.5%; width:12.5%;"></div>
<div id="modulo7" class="modulo" style="left:75%; width:12.5%;"></div>
<div id="modulo8" class="modulo" style="left:87.5%; width:12.5%;"></div>

</div>

<!-- Vista cenital -->
<h4>Vista Cenital</h4>

<svg viewBox="0 0 400 80" width="100%" style="max-width:400px;">

<rect id="top1" x="0" y="20" width="50" height="40" class="estante-top"/>
<rect id="top2" x="50" y="20" width="50" height="40" class="estante-top"/>
<rect id="top3" x="100" y="20" width="50" height="40" class="estante-top"/>
<rect id="top4" x="150" y="20" width="50" height="40" class="estante-top"/>
<rect id="top5" x="200" y="20" width="50" height="40" class="estante-top"/>
<rect id="top6" x="250" y="20" width="50" height="40" class="estante-top"/>
<rect id="top7" x="300" y="20" width="50" height="40" class="estante-top"/>
<rect id="top8" x="350" y="20" width="50" height="40" class="estante-top"/>

</svg>

</div>

</div>

</div>

<script>
const sheetID="1IU4wMdVImmEbl93kgcCCQAGPiTc28uQdNNaq0bgTF2o";
const sheetName="Mujer";
const tabla=document.getElementById("tabla");
const buscador=document.getElementById("buscar");

fetch(`https://docs.google.com/spreadsheets/d/${sheetID}/export?format=csv&sheet=${sheetName}`)
.then(res=>res.text())
.then(csv=>{
  const filas=csv.split("\n");
  let html="";
  filas.slice(1).forEach(f=>{
    const c=f.split(",");
    html+=`
    <tr data-ubic="${c[20]}" data-almacen="${c[21]}"
    data-fulltext="${c.join(" ")}">
    <td>${c[10]}</td>
    <td>${c[12]}</td>
    <td>${c[13]}</td>
    <td>${c[20]}</td>
    <td>${c[21]}</td>
    </tr>`;
  });
  tabla.innerHTML=html;
});

function limpiarModulos(){
  document.querySelectorAll(".modulo").forEach(m=>m.classList.remove("activo"));
  document.querySelectorAll(".estante-top").forEach(t=>t.classList.remove("activo"));
}

function obtenerZona(u,a){
  if(a) return "A";
  if(u.startsWith("Z2")) return "Z2";
  if(u.startsWith("Z1")) return "Z1";
  if(u.startsWith("Z3")) return "Z3";
}

buscador.addEventListener("input",()=>{
  const f=buscador.value.toLowerCase();
  limpiarModulos();
  document.querySelectorAll(".zona")
  .forEach(z=>z.classList.remove("highlight"));

  document.querySelectorAll("#tabla tr")
  .forEach(tr=>{
    if(tr.dataset.fulltext.toLowerCase().includes(f)){
      tr.style.display="";
      const zona=obtenerZona(tr.dataset.ubic,tr.dataset.almacen);
      document.getElementById(zona)?.classList.add("highlight");

      if(zona==="Z2"){
        document.getElementById("zona2Detalle").style.display="block";

        // detectar m贸dulo tipo Z2-M3
        const match = tr.dataset.ubic.match(/M(\d+)/);
        if(match){
          const num = match[1];
          document.getElementById("modulo"+num)?.classList.add("activo");
          document.getElementById("top"+num)?.classList.add("activo");
        }
      } else {
        document.getElementById("zona2Detalle").style.display="none";
      }

    } else {
      tr.style.display="none";
    }
  });
});
</script>

</body>
</html>
